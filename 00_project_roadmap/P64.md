# P64: Admin UI Integration

## 1. Objective

**What**: Add import functionality to the admin dashboard with file upload, progress tracking, and error reporting components.

**Why**: Command-line imports are developer-only. Admin UI enables non-technical users to import QA pairs, see visual progress feedback, preview data before confirming, and investigate errors.

**Scope**:
- Included: File upload dropzone, format selection, preview modal, progress display, error report view
- Excluded: Backend API (P63), parsing/validation logic (P60-P61)

**Dependencies**: P63 (Import API endpoints)

---

## 2. Implementation Tasks

### Task 64.1: Create Import API Client

- [ ] TypeScript client for import endpoints (1 file, ~60 LOC)
  - **Tests**: `frontend/tests/services/import-api.test.ts`
    - `test_uploadCSV_sends_multipart()` - FormData with file
    - `test_uploadCSV_returns_job_id()` - parses response
    - `test_getStatus_polls_endpoint()` - fetches status
    - `test_getHistory_supports_pagination()` - query params
    - `test_downloadErrors_returns_blob()` - CSV download
  - **Files**: `frontend/src/services/ImportApi.ts`
  - **Implementation**:
    ```typescript
    export const importApi = {
      uploadCSV: (file: File) => Promise<ImportResponse>,
      uploadJSON: (file: File) => Promise<ImportResponse>,
      uploadText: (file: File) => Promise<ImportResponse>,
      getStatus: (jobId: string) => Promise<JobStatusResponse>,
      getHistory: (page: number, status?: string) => Promise<ImportHistoryResponse>,
      downloadErrors: (jobId: string) => Promise<Blob>,
    }
    ```

### Task 64.2: Create File Upload Dropzone

- [ ] Drag-and-drop file upload component (2 files, ~120 LOC)
  - **Tests**: `frontend/tests/components/ImportDropzone.test.tsx`
    - `test_renders_dropzone()` - visible upload area
    - `test_accepts_drag_and_drop()` - file drop works
    - `test_accepts_click_to_browse()` - file picker
    - `test_validates_file_extension()` - rejects invalid types
    - `test_validates_file_size()` - rejects > 10MB
    - `test_shows_selected_file()` - filename displayed
    - `test_calls_onFileSelected()` - callback fired
  - **Files**: `frontend/src/components/import/ImportDropzone.tsx`, `frontend/src/components/import/ImportDropzone.css`
  - **Props**:
    ```typescript
    interface ImportDropzoneProps {
      acceptedTypes: string[];  // [".csv", ".json", ".txt"]
      maxSize: number;          // bytes
      onFileSelected: (file: File) => void;
    }
    ```

### Task 64.3: Create Import Preview Modal

- [ ] Preview parsed data before confirming import (2 files, ~100 LOC)
  - **Tests**: `frontend/tests/components/ImportPreview.test.tsx`
    - `test_shows_row_count()` - "X QA pairs detected"
    - `test_shows_sample_rows()` - first 5 rows preview
    - `test_shows_validation_warnings()` - warning list
    - `test_shows_duplicate_warnings()` - duplicate matches
    - `test_confirm_button_starts_import()` - triggers upload
    - `test_cancel_button_closes_modal()` - dismisses
  - **Files**: `frontend/src/components/import/ImportPreview.tsx`
  - **Note**: Preview is client-side parsing only (no server round-trip for preview)

### Task 64.4: Create Import Progress Component

- [ ] Visual progress indicator during import (2 files, ~80 LOC)
  - **Tests**: `frontend/tests/components/ImportProgress.test.tsx`
    - `test_shows_progress_bar()` - visual bar
    - `test_shows_percentage()` - "X% complete"
    - `test_shows_row_counts()` - "X of Y rows"
    - `test_shows_success_count()` - green count
    - `test_shows_error_count()` - red count
    - `test_polls_status_endpoint()` - updates periodically
    - `test_stops_polling_on_complete()` - cleans up
  - **Files**: `frontend/src/components/import/ImportProgress.tsx`
  - **Polling**: 2-second interval until completed/failed

### Task 64.5: Create Import Error Report View

- [ ] Display and download error details (2 files, ~80 LOC)
  - **Tests**: `frontend/tests/components/ImportErrors.test.tsx`
    - `test_shows_error_table()` - row/field/message columns
    - `test_pagination_for_many_errors()` - handles 100+ errors
    - `test_download_button_gets_csv()` - triggers download
    - `test_shows_empty_state()` - "No errors" message
  - **Files**: `frontend/src/components/import/ImportErrors.tsx`
  - **Features**: Sortable table, CSV download button

### Task 64.6: Create Import Page

- [ ] Full import page combining all components (2 files, ~100 LOC)
  - **Tests**: `frontend/tests/pages/ImportPage.test.tsx`
    - `test_renders_dropzone_initially()` - upload state
    - `test_shows_preview_after_file_select()` - preview state
    - `test_shows_progress_after_confirm()` - progress state
    - `test_shows_results_on_complete()` - results state
    - `test_shows_errors_if_any()` - error display
    - `test_reset_button_clears_state()` - start over
  - **Files**: `frontend/src/pages/ImportPage.tsx`, `frontend/src/pages/ImportPage.css`
  - **State machine**: idle → file_selected → uploading → processing → complete

### Task 64.7: Create Import History Page

- [ ] List past imports with status and actions (2 files, ~80 LOC)
  - **Tests**: `frontend/tests/pages/ImportHistoryPage.test.tsx`
    - `test_renders_import_list()` - table of imports
    - `test_shows_status_badges()` - colored status
    - `test_shows_row_counts()` - success/error counts
    - `test_filter_by_status()` - status dropdown
    - `test_view_details_link()` - navigates to details
    - `test_pagination_controls()` - page navigation
  - **Files**: `frontend/src/pages/ImportHistoryPage.tsx`
  - **Columns**: Date, Filename, Type, Status, Rows, Success, Errors, Actions

### Task 64.8: Add Navigation Links

- [ ] Add import pages to admin navigation (1 file, ~20 LOC)
  - **Tests**: `frontend/tests/components/Navigation.test.tsx`
    - `test_shows_import_link()` - "Import QA" in nav
    - `test_shows_history_link()` - "Import History" in nav
    - `test_links_navigate_correctly()` - router works
  - **Files**: `frontend/src/components/Navigation.tsx` (extend)
  - **Routes**: `/admin/import`, `/admin/import/history`

---

## 3. Success Criteria

- [ ] Drag-and-drop file upload works
- [ ] File validation prevents invalid uploads
- [ ] Preview shows sample data before import
- [ ] Progress bar updates in real-time
- [ ] Error report viewable and downloadable
- [ ] Import history filterable and paginated
- [ ] State machine handles all transitions
- [ ] All tests pass: `npm test -- --run frontend/tests/components/import frontend/tests/pages/Import`
- [ ] Coverage ≥80% for import components
