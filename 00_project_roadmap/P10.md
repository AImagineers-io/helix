# P10: Improvement Plan for P4.md

## What's Weak / Missing

- **No automated verification**: Grep check is manual. Should be pre-commit hook or CI check.
- **Missing third-party references**: npm package.json may have "palai" in name. Docker image tags. Git remote URLs.
- **No database content audit**: QA pairs, prompts, conversations in existing DB may contain client-specific text.
- **Variety code remains**: Disabled but not removed. Dead code accumulates. Cleanup strategy undefined.
- **OpenAPI spec not updated**: Auto-generated docs will show new endpoints but descriptions may reference old names.
- **No coordinated cutover**: When exactly to rename? During deploy? Before? Risk of partial rename.
- **Git history concern unaddressed**: History contains "PALAI". Not fixable but should be documented.
- **Error messages not audited**: Exception handlers, validation errors may contain client-specific text.
- **No verification test for complete rename**: Success criteria says grep returns zero but no automated enforcement.

---

## Why This Matters

Incomplete rebranding causes:
- Client embarrassment (seeing competitor's name)
- Legal/contractual issues (shipping client A's brand to client B)
- Technical debt (dead variety code)
- Ongoing maintenance burden (manual checks every release)

Rebranding must be verifiable, automated, and complete.

---

## Proposed Improvements

### Add new task: P4.0 - Pre-Commit Hook for Branding Check

- [ ] Add automated branding verification hook (2 files, ~50 LOC)
  - Tests: (hook self-tests)
  - Files: .pre-commit-config.yaml, scripts/check-branding.sh
  - Blocks commit if grep finds prohibited terms
  - Terms: palai, philrice, rice (with exceptions for config)
  - Runs on: *.py, *.ts, *.tsx, *.md, *.json
  - Depends on: P4.1

### Add new task: P4.0a - CI Branding Verification

- [ ] Add CI pipeline step for branding check (1 file, ~30 LOC)
  - Tests: (CI validates itself)
  - Files: .gitlab-ci.yml or .github/workflows/ci.yml
  - Fails build if prohibited terms found
  - Runs on every PR/MR
  - Depends on: P4.0

### Add new task: P4.1a - Third-Party Reference Audit

- [ ] Audit and update all third-party references (4 files, ~40 LOC)
  - Tests: tests/integration/test_third_party_refs.py
  - Files: package.json (name), docker-compose.yml (image names), .gitlab-ci.yml (variables), git remote URLs
  - Change: "palai" â†’ "helix" in package names
  - Document: git remotes need manual update per-fork
  - Depends on: P4.1

### Add new task: P4.2a - Database Content Audit

- [ ] Create migration to audit DB content (2 files, ~80 LOC)
  - Tests: tests/integration/test_db_content_audit.py
  - Files: alembic/versions/xxx_audit_content.py, scripts/audit_db_content.py
  - Scan: QA pairs, prompts, local_automations for prohibited terms
  - Output: report of rows needing manual review
  - Non-destructive (report only, no auto-update)
  - Depends on: P4.3

### Add new task: P4.4a - Variety Code Removal

- [ ] Remove variety processor code entirely (delete, ~500 LOC removed)
  - Tests: tests/integration/test_no_variety_code.py
  - Files: DELETE services/variety/, DELETE api/routers/rice_varieties.py, DELETE processors/variety.py
  - Keep: RiceVariety models (may need for data migration)
  - Add: TODO comment for model removal after all clients migrated
  - Depends on: P4.4

### Add new task: P4.5a - OpenAPI Description Update

- [ ] Update API documentation descriptions (1 file, ~30 LOC)
  - Tests: tests/integration/test_openapi_docs.py
  - Files: api/main.py, api/routers/*.py
  - Update: FastAPI description, endpoint docstrings
  - Verify: /docs page shows "Helix" not "PALAI"
  - Depends on: P4.2

### Add new task: P4.6a - Error Message Audit

- [ ] Audit exception messages for client-specific text (1 file, ~0 LOC)
  - Tests: tests/integration/test_error_messages.py
  - Files: (audit only, fix in place)
  - Grep for prohibited terms in exception strings
  - Update messages to use config values or generic text
  - Depends on: P4.2

### Add new task: P4.9 - Rename Verification Test

- [ ] Create comprehensive rename verification test (1 file, ~100 LOC)
  - Tests: tests/integration/test_complete_rebrand.py
  - Files: (test file only)
  - Verifies: grep returns zero matches in all source
  - Verifies: API docs show correct branding
  - Verifies: health endpoint returns correct name
  - Verifies: frontend bundle contains no prohibited terms
  - Depends on: P4.8

### Add to Success Criteria

- [ ] Pre-commit hook blocks commits with prohibited terms
- [ ] CI fails on branding violations
- [ ] package.json name is "helix" (not "palai")
- [ ] Docker images tagged as helix-*
- [ ] Database content audit report generated
- [ ] Variety processor code deleted (not just disabled)
- [ ] /docs page shows "Helix API"
- [ ] Comprehensive rename test passes in CI

---

## Impact on Roadmap

- **P5**: Demo setup must pass branding verification
- **All future development**: Pre-commit hook prevents reintroduction of prohibited terms
- **Fork process**: Document that git remotes must be manually updated

No sequencing changes. These are hardening tasks for P4.
