# P8: Improvement Plan for P2.md

## What's Weak / Missing

- **No error handling UX**: What shows when API fails? Blank screen? Generic error? No guidance.
- **Missing unsaved changes warning**: User edits prompt, clicks away, loses work. Standard UX failure.
- **No diff view**: Can't compare versions side-by-side. Critical for reviewing changes.
- **No search/filter**: If 20+ prompt templates exist, no way to find them quickly.
- **Loading states only in criteria**: Tasks don't mention implementing loading skeletons.
- **No conflict resolution UI**: P1 may return 409 Conflict (P7 improvement). UI must handle it.
- **No keyboard shortcuts**: Power users expect Ctrl+S to save, Ctrl+Z to undo.
- **No mobile considerations**: Will this work on tablet? Admin may review from mobile.
- **Preview mode has no sample context**: How does admin provide test variables for preview?

---

## Why This Matters

Admin UI is the daily driver for non-technical staff. Poor UX leads to:
- Accidental data loss (unsaved changes)
- Support tickets ("it didn't save", "I don't know what changed")
- Slow workflows (can't find prompts, can't compare versions)
- Frustration leading to workarounds (editing DB directly)

---

## Proposed Improvements

### Add new task: P2.0 - Error Boundary Component

- [ ] Create global error boundary with retry (1 file, ~50 LOC)
  - Tests: tests/components/ErrorBoundary.test.tsx
  - Files: src/components/common/ErrorBoundary.tsx
  - Catches render errors, shows friendly message
  - "Something went wrong" + Retry button + Copy Error Details
  - Depends on: None (foundational)

### Add new task: P2.1a - API Error Handler

- [ ] Create toast notification system for API errors (2 files, ~80 LOC)
  - Tests: tests/components/Toast.test.tsx
  - Files: src/components/common/Toast.tsx, src/hooks/useToast.ts
  - API failures show toast with message
  - 409 Conflict shows "Someone else edited this prompt. Refresh to see changes."
  - Depends on: P2.1

### Add new task: P2.3a - Unsaved Changes Guard

- [ ] Warn before navigation with unsaved changes (1 file, ~40 LOC)
  - Tests: tests/hooks/useUnsavedChanges.test.ts
  - Files: src/hooks/useUnsavedChanges.ts
  - Uses beforeunload event
  - React Router blocker for internal navigation
  - Depends on: P2.3

### Add new task: P2.4a - Version Diff View

- [ ] Add side-by-side diff between versions (2 files, ~120 LOC)
  - Tests: tests/components/VersionDiff.test.tsx
  - Files: src/components/prompts/VersionDiff.tsx, src/utils/diff.ts
  - Use diff library (diff-match-patch or similar)
  - Highlight additions (green), deletions (red)
  - Toggle: unified vs split view
  - Depends on: P2.4

### Add new task: P2.2a - Prompt Search/Filter

- [ ] Add search bar and type filter to prompt list (1 file, ~60 LOC)
  - Tests: tests/components/PromptSearch.test.tsx
  - Files: src/components/prompts/PromptSearch.tsx
  - Text search on name/description
  - Filter by prompt type (dropdown)
  - Debounced input (300ms)
  - Depends on: P2.2

### Add new task: P2.6a - Preview with Context Editor

- [ ] Add context variable editor for preview mode (1 file, ~80 LOC)
  - Tests: tests/components/PreviewContext.test.tsx
  - Files: src/components/prompts/PreviewContext.tsx
  - JSON editor for sample context variables
  - Auto-detect variables from prompt content (regex: `{variable}`)
  - Pre-fill with example values
  - Depends on: P2.6

### Modify P2.3 - Add Loading Skeleton

- [ ] Implement skeleton loading states
  - PromptEditor shows skeleton while loading
  - VersionHistory shows placeholder items
  - Add: src/components/common/Skeleton.tsx

### Add to P2.7 - Keyboard Shortcuts

- [ ] Add keyboard shortcuts (1 file, ~40 LOC)
  - Tests: tests/hooks/useKeyboardShortcuts.test.ts
  - Files: src/hooks/useKeyboardShortcuts.ts
  - Ctrl+S / Cmd+S: Save draft
  - Ctrl+Enter: Publish
  - Escape: Cancel/close
  - Depends on: P2.3

### Add to Success Criteria

- [ ] API errors show toast notification (not silent failure)
- [ ] 409 Conflict shows specific conflict message
- [ ] Navigating away with unsaved changes shows warning
- [ ] Version diff view available from history sidebar
- [ ] Prompt list searchable by name
- [ ] Prompt list filterable by type
- [ ] Preview mode allows custom context variables
- [ ] Loading skeletons shown during fetch
- [ ] Ctrl+S saves prompt

---

## Impact on Roadmap

- **P3**: Toast system can be reused for dashboard notifications
- **P3**: Skeleton components reusable for dashboard widgets
- **P5**: Screenshots should show diff view, search, preview with context

No blocking changes to sequencing. All improvements additive to P2.
