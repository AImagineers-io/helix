# P6: Improvement Plan for P0.md

## What's Weak / Missing

- **No config validation**: Missing startup checks for required environment variables. App will fail cryptically at runtime instead of clearly at boot.
- **No default fallbacks**: If `BOT_NAME` is unset, what happens? Undefined behavior.
- **Missing secrets separation**: API keys (OPENAI_API_KEY) mixed with branding config (LOGO_URL). Security concern for logging/exposure.
- **No environment detection**: No distinction between dev/staging/production. Feature flags should differ per environment.
- **Missing config schema**: No typed schema for config values. TypeScript frontend will struggle with type safety.
- **No migration strategy**: Existing PALAI installations need a path to adopt new config. Not addressed.
- **Branding API has no caching**: Every page load hits the endpoint. Performance concern at scale.

---

## Why This Matters

Config is the foundation for every white-label deployment. Ambiguity here causes:
- Silent failures in production (missing env vars)
- Security incidents (exposed secrets in logs)
- Inconsistent behavior across environments
- Developer confusion during onboarding

Every downstream phase (P1-P5) depends on P0 being rock-solid.

---

## Proposed Improvements

### Add to P0.2 (Branding Configuration)

- [ ] Define required vs optional config with explicit defaults
  - Tests: tests/unit/test_config_defaults.py
  - Files: core/config.py
  - Required: APP_NAME, BOT_NAME (fail if missing)
  - Optional with defaults: LOGO_URL (null), PRIMARY_COLOR (#007bff)

### Add new task: P0.8 - Config Validation at Startup

- [ ] Validate all required config on app boot (1 file, ~50 LOC)
  - Tests: tests/unit/test_config_validation.py
  - Files: core/config.py
  - Fail fast with clear error messages listing missing vars
  - Depends on: P0.1

### Add new task: P0.9 - Secrets Isolation

- [ ] Separate secrets from branding config (1 file, ~30 LOC)
  - Tests: tests/unit/test_secrets_config.py
  - Files: core/config.py
  - Create `SecretsConfig` class (API keys, tokens)
  - Create `BrandingConfig` class (public-safe values)
  - Branding API only exposes `BrandingConfig`
  - Depends on: P0.2

### Add new task: P0.10 - Config Schema Export

- [ ] Generate TypeScript types from config schema (1 file, ~40 LOC)
  - Tests: (manual verification)
  - Files: scripts/generate-config-types.py, frontend/src/types/config.ts
  - Frontend gets type-safe branding object
  - Depends on: P0.9

### Modify P0.5 (Branding API)

- [ ] Add ETag/cache headers to branding endpoint
  - Cache-Control: public, max-age=3600
  - ETag for conditional requests
  - Frontend caches in localStorage with TTL

### Add to Success Criteria

- [ ] App fails to start with clear message if required config missing
- [ ] Secrets config never exposed via /branding endpoint
- [ ] Frontend has TypeScript types for branding config
- [ ] Branding API returns cache headers

---

## Impact on Roadmap

- **P1**: Prompt loading can rely on validated config for default prompt fallbacks
- **P3**: Settings page can display config types accurately (required vs optional)
- **P4**: Migration from PALAI can validate config completeness before deploy
- **P5**: Demo environment config validated automatically

No phase sequencing changes required. These are additive enhancements to P0.
