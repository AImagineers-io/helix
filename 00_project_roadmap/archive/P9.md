# P9: Improvement Plan for P3.md

## What's Weak / Missing

- **No refresh strategy**: Dashboard data goes stale. No auto-refresh, no manual refresh button defined.
- **Missing date range picker**: Cost and conversation stats need date filtering. Only "this month" mentioned.
- **No empty states**: New instance has zero conversations, zero costs. What shows? Blank widgets are confusing.
- **Settings page contradiction**: Described as "read-only" but objective says "settings page for instance configuration". Which is it?
- **Missing conversation browser**: Analytics mention conversation count but no way to view actual conversations.
- **No cost projection algorithm**: "Projected month-end" mentioned but calculation method undefined.
- **Analytics aggregation strategy undefined**: Pre-computed daily aggregates vs on-demand calculation? Performance implications.
- **No export capability**: Admin can't download analytics data for reporting.

---

## Why This Matters

Dashboard is the daily touchpoint for admins. Weak implementation means:
- Admins refresh browser to see updates (poor UX)
- No ability to analyze historical trends
- Confusion on empty instances
- Support requests for data exports
- Performance issues if aggregation is on-demand

---

## Proposed Improvements

### Add new task: P3.0 - Dashboard Auto-Refresh

- [ ] Add configurable auto-refresh for dashboard (1 file, ~40 LOC)
  - Tests: tests/hooks/useAutoRefresh.test.ts
  - Files: src/hooks/useAutoRefresh.ts
  - Default: 60 seconds
  - Manual refresh button in header
  - Pause auto-refresh when tab is hidden
  - Depends on: None (foundational)

### Add new task: P3.1a - Date Range Picker Component

- [ ] Add reusable date range picker (2 files, ~100 LOC)
  - Tests: tests/components/DateRangePicker.test.tsx
  - Files: src/components/common/DateRangePicker.tsx, src/hooks/useDateRange.ts
  - Presets: Today, Last 7 days, Last 30 days, This month, Custom
  - Used by cost widget and conversation stats
  - Depends on: P3.1

### Add new task: P3.2a - Empty State Components

- [ ] Create empty state illustrations for widgets (1 file, ~60 LOC)
  - Tests: tests/components/EmptyState.test.tsx
  - Files: src/components/common/EmptyState.tsx
  - Variants: no_data, no_conversations, no_costs
  - Friendly message + optional CTA ("Import QA pairs to get started")
  - Depends on: P3.2

### Add new task: P3.1b - Analytics Pre-Aggregation

- [ ] Define aggregation strategy in backend (2 files, ~80 LOC)
  - Tests: tests/integration/test_analytics_aggregation.py
  - Files: services/analytics_service.py, database/models.py (DailyAggregate)
  - Pre-compute daily aggregates via scheduled job
  - Store: date, conversation_count, message_count, avg_response_time, cost_total
  - API reads from aggregates, not raw data
  - Depends on: P3.1

### Add new task: P3.5a - Cost Projection Logic

- [ ] Define cost projection algorithm (1 file, ~40 LOC)
  - Tests: tests/unit/test_cost_projection.py
  - Files: services/cost_service.py
  - Algorithm: (month_to_date_cost / days_elapsed) * days_in_month
  - Handle edge case: first day of month (no projection)
  - Show confidence indicator based on data volume
  - Depends on: P3.5

### Add new task: P3.8 - Conversation Browser

- [ ] Add conversation list and detail view (3 files, ~200 LOC)
  - Tests: tests/pages/Conversations.test.tsx
  - Files: src/pages/Conversations.tsx, src/pages/ConversationDetail.tsx, src/services/conversations-api.ts
  - List: date, device_id, message count, status
  - Detail: full message history with timestamps
  - Filter by date range, platform
  - Depends on: P3.1a

### Add new task: P3.9 - Analytics Export

- [ ] Add CSV export for analytics data (2 files, ~60 LOC)
  - Tests: tests/integration/test_analytics_export.py
  - Files: api/routers/analytics.py (extend), src/components/dashboard/ExportButton.tsx
  - Export conversations, costs, daily aggregates
  - Format: CSV with headers
  - Depends on: P3.1

### Clarify P3.6 - Settings Page Scope

- [ ] Make settings page partially editable
  - Read-only: APP_NAME, instance config (from env)
  - Editable: DevSettings-style config (notification preferences, display options)
  - Store editable settings in database
  - Depends on: P0

### Add to Success Criteria

- [ ] Dashboard auto-refreshes every 60 seconds
- [ ] Manual refresh button in dashboard header
- [ ] Date range picker on cost and conversation widgets
- [ ] Empty states show friendly message on new instances
- [ ] Conversation list accessible from dashboard
- [ ] Conversation detail shows full chat history
- [ ] Cost projection shows algorithm basis
- [ ] Analytics exportable to CSV
- [ ] Daily aggregates pre-computed (not on-demand)

---

## Impact on Roadmap

- **P5**: Screenshots should show populated dashboard with date range picker
- **P5**: Demo data must include realistic aggregates for dashboard
- **Backend**: Scheduled job for aggregation needs infrastructure (covered in P3.1b)

Adds one new page (Conversations) which may warrant breaking P3 into P3a/P3b if scope exceeds 2000 tokens.
