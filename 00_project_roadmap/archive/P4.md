# P4: Rebranding & Cleanup

## Source Reference

**PALAI Path**: `/mnt/d/codes/palai/`

### Files with PALAI/PhilRice Branding to Clean

**Backend:**
- `backend/api/main.py` - App title, description
- `backend/core/health.py` - Health check name
- `backend/services/chat/processors/retrieval_llm.py` - System prompts mention "PALAI", "PhilRice"
- `backend/services/chat/processors/intent.py` - Greeting responses
- `backend/services/moderation/rejection_handler.py` - Rejection messages
- `docker-compose.yml` - Service names (palai-backend → helix-backend)

**Frontend:**
- `frontend/index.html` - Page title
- `frontend/src/App.tsx` - App name
- `frontend/src/components/ChatInterface.tsx` - Bot name, avatar
- `frontend/src/pages/Home.tsx` - Landing page copy
- `frontend/public/` - Logo, favicon

**Rice-Specific Logic:**
- `backend/services/variety/` - Entire directory (rice variety detection)
- `backend/database/models.py` - RiceVariety, VarietyAlias, VarietyAgronomics, etc.
- `backend/api/routers/rice_varieties.py` - Rice variety CRUD
- `backend/services/chat/processors/variety.py` - Variety processor

---

## 1. Objective

- **What**: Remove PhilRice/PALAI-specific code and ensure all branding uses config values.
- **Why**: Helix is a white-label product; the source repo must be clean of client-specific content so forks start fresh.
- **Scope**:
  - **Included**: Remove hardcoded branding, use config values, make variety processor optional, rename Docker services
  - **Excluded**: Custom CSS themes, advanced theme builder

---

## 2. Implementation Tasks

- [ ] Audit and list all PALAI/PhilRice references (1 file, ~0 LOC)
  - Tests: tests/integration/test_no_palai_references.py (grep-based)
  - Files: (audit document only)
  - PALAI ref: Run `grep -ri "palai\|philrice\|rice" --include="*.py" --include="*.tsx" --include="*.ts"`
  - Depends on: P0

- [ ] Replace hardcoded branding with config values (3 files, ~40 LOC)
  - Tests: tests/integration/test_branding_from_config.py
  - Files: api/main.py, core/health.py, services/chat/processors/intent.py
  - PALAI ref: `backend/api/main.py:app = FastAPI(title="PALAI"...)` → use settings.APP_NAME
  - Depends on: P0.1

- [ ] Make system prompts domain-agnostic (2 files, ~100 LOC)
  - Tests: tests/integration/test_prompts_no_rice.py
  - Files: database/seeds/prompts.py, services/chat/processors/retrieval_llm.py
  - PALAI ref: `backend/services/chat/processors/retrieval_llm.py` - system prompt
  - Depends on: P1.6

- [ ] Make variety processor optional via feature flag (2 files, ~50 LOC)
  - Tests: tests/integration/test_variety_processor_disabled.py
  - Files: services/chat/pipeline.py, core/config.py
  - PALAI ref: `backend/services/chat/pipeline.py` - processor registration
  - Config: ENABLE_VARIETY_PROCESSOR=false by default
  - Depends on: P0.3

- [ ] Update frontend to use branding from API (3 files, ~80 LOC)
  - Tests: tests/components/Branding.test.tsx
  - Files: src/App.tsx, src/components/ChatInterface.tsx, src/hooks/useBranding.ts
  - PALAI ref: `frontend/src/App.tsx`, `frontend/src/components/ChatInterface.tsx`
  - Depends on: P0.5

- [ ] Replace static assets with configurable ones (2 files, ~30 LOC)
  - Tests: (manual verification)
  - Files: frontend/index.html, frontend/public/favicon.ico
  - Use generic Helix branding as default
  - Depends on: P4.5

- [ ] Rename Docker services (2 files, ~20 LOC)
  - Tests: (manual verification)
  - Files: docker-compose.yml, .env.example
  - PALAI ref: `docker-compose.yml` - palai-backend → helix-backend
  - Depends on: P0

- [ ] Update repository metadata (3 files, ~50 lines)
  - Tests: (manual verification)
  - Files: README.md, package.json, version.json
  - Depends on: P4.7

---

## 3. Success Criteria

- [ ] `grep -ri "palai" backend/ frontend/` returns zero matches (excluding git history)
- [ ] `grep -ri "philrice" backend/ frontend/` returns zero matches
- [ ] App name uses APP_NAME from config throughout
- [ ] Bot name uses BOT_NAME from config in chat responses
- [ ] Frontend loads branding from /branding API endpoint
- [ ] Chat widget displays configured logo and colors
- [ ] Variety processor disabled when ENABLE_VARIETY_PROCESSOR=false
- [ ] Docker services named helix-backend, helix-frontend, helix-redis
- [ ] README describes Helix (not PALAI)
- [ ] Default branding is generic "Helix" theme
